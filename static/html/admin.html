<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>系统管理员页面</title>

    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="/static/fontawesome/css/all.min.css">
    <!-- Theme style -->
    <link rel="stylesheet" href="/static/adminlte/css/adminlte.min.css">


    <style>
        tr {
            text-align: center;
        }
        .alternative {
            margin-bottom: 10px;
        }

        option {
            border: 1px solid black;
        }

        .check-btn[checked] span {
            background-color: red;
        }

        textarea {
            resize: none;
        }

        .modal-dialog {
            min-width: 700px !important;
        }

        .modal-header {
            border: none;
            padding: 5px 15px 10px;
        }

        .modal-header .nav-tabs {
            width: 100%;
        }

        .modal-header .nav-tabs .active {
            border-top: 3px solid #007bff !important;
        }

        .modal-header .nav-tabs .nav-link {
            padding: 8px 20px;
        }

        .modal-header .nav-tabs .nav-link:hover {
            border-top: 3px solid #dee2e6;
        }
    </style>
</head>
<body class="hold-transition sidebar-mini layout-fixed">
<div class="wrapper">
    <!-- Navbar -->
    <nav class="main-header navbar navbar-expand navbar-white navbar-light shadow">
        <!-- Left navbar links -->
        <ul class="navbar-nav">
            <li class="nav-item">
                <a class="nav-link" data-widget="pushmenu" href="#" role="button">
                    <i class="fas fa-bars">
                    </i>
                </a>
            </li>
            <li class="nav-item d-none d-sm-inline-block">
                <a href="/" class="nav-link active">首页</a>
            </li>
        </ul>
        <ul class="navbar-nav ml-auto">
                <li class="nav-item">
                    <a class="nav-link" data-widget="fullscreen" href="#" role="button">
                        <i class="fas fa-expand-arrows-alt"></i>
                    </a>
                </li>
            </ul>
    </nav>
    <!-- /.navbar -->

    <!-- Main Sidebar Container -->
    <aside class="main-sidebar sidebar-dark-primary elevation-4">
        <!-- Brand Logo -->
        <a href="#" class="brand-link">
            <img src="/static/img/logo_white.png" alt="Logo" class="brand-image img-md elevation-3"
                 style="opacity: .8">
            <span class="brand-text font-weight-light">在线考试系统</span>
        </a>

        <!-- Sidebar -->
        <div class="sidebar">
            <!-- Sidebar user panel (optional) -->
            <div class="user-panel mt-3 pb-3 mb-3 d-flex">
                <div class="image">
                    <img src="/static/img/avatar.png" class="img-circle elevation-2" alt="User Image">
                </div>
                <div class="info">
                    <a href="#" class="d-block">系统管理员，您好！</a>
                </div>
            </div>

            <!-- Sidebar Menu -->
            <nav class="mt-2">
                <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu"
                    data-accordion="false">
                    <li class="nav-header">管理</li>
                    <li class="nav-item">
                        <a  class="nav-link active" id="mentor-manage">
                            <i class="nav-icon fas fa-paper-plane"></i>
                            <p>
                                教师管理
                            </p>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a  class="nav-link" id="student-manage">
                            <i class="nav-icon fas fa-paperclip"></i>
                            <p>
                                学生管理
                            </p>
                        </a>
                    </li>
                    <li class="nav-header">账号</li>
                    <li class="nav-item">
                        <a  class="nav-link" id="logout">
                            <i class="nav-icon fas fa-door-open"></i>
                            <p>
                                退出登录
                            </p>
                        </a>
                    </li>
                </ul>
            </nav>
            <!-- /.sidebar-menu -->

            </nav>
            <!-- /.sidebar-menu -->
        </div>
        <!-- /.sidebar -->
    </aside>


    <div class="content-wrapper" style="min-height: 1332.2px;">
        <!-- Content Header (Page header) -->
        <section class="content-header">
            <div class="container-fluid">
                <div class="row mb-2">
                    <div class="col-sm-6">
                        <h1>教师信息管理</h1>
                    </div>
                    <div class="col-sm-6">
                        <ol class="breadcrumb float-sm-right">
                            <li class="breadcrumb-item"><a href="#" style="color: black">刷新教师列表</a></li>
                        </ol>
                    </div>
                </div>
            </div>
        </section>

        <!-- Main content -->
        <section class="content">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <button type="button" class="btn btn-outline-success" data-toggle="modal" data-target="#newteacher">添加教师</button>
                            </div>
                            <!-- /.card-header -->
                            <div class="card-body">
                                <div id="example1_wrapper" class="dataTables_wrapper dt-bootstrap4">
                                    <div class="row" style="margin-bottom: 15px;">
                                        <div class="col-sm-12 col-md-6">
                                            <div class="dt-buttons btn-group flex-wrap">
                                                <div class="dropdown">
                                                    <a class="btn btn-outline-primary  dropdown-toggle" href="#"
                                                       role="button" id="dropdownMenuLink1" data-toggle="dropdown"
                                                       aria-haspopup="true" aria-expanded="false">
                                                        按职称筛选
                                                    </a>
                                                    <div class="dropdown-menu " aria-labelledby="dropdownMenuLink" id="dropdownMenuLink">
                                                        <a class="dropdown-item btn-outline-primary s0000">全部</a>
                                                        <a class="dropdown-item btn-outline-primary s0001">讲师</a>
                                                        <a class="dropdown-item btn-outline-primary s0002">副教授</a>
                                                        <a class="dropdown-item btn-outline-primary s0003">教授</a>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-sm-12 col-md-2 offset-3">
                                            <div id="example2_filter" class="dataTables_filter">
                                                <input type="search" class="form-control form-control-sm"
                                                       placeholder="按教师姓名搜索" aria-controls="example1" id="nameinput">
                                            </div>
                                        </div>
                                        <div class="col-sm-12 col-md-1">
                                            <button type="button" class="btn btn-outline-primary" id="namesearch">搜索</button>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-sm-12">
                                            <table id="example1"
                                                   class="table table-bordered table-striped dataTable dtr-inline"
                                                   role="grid" aria-describedby="example1_info">
                                                <thead>
                                                <tr role="row">
                                                    <th class="sorting" tabindex="0" aria-controls="example1"
                                                        rowspan="1" colspan="1">教师编号
                                                    </th>
                                                    <th class="sorting" tabindex="0" aria-controls="example1"
                                                        rowspan="1" colspan="1" style="width: 100px;">教师姓名
                                                    </th>
                                                    <th class="sorting" tabindex="0" aria-controls="example1"
                                                        rowspan="1" colspan="1" style="width: 100px;">教师性别
                                                    </th>
                                                    <th class="sorting" tabindex="0" aria-controls="example1"
                                                        rowspan="1" colspan="1" style="width: 270px;">教师职称
                                                    </th>
                                                    <th class="sorting" tabindex="0" aria-controls="example1"
                                                        rowspan="1" colspan="1" style="width: 270px;">操作
                                                    </th>
                                                </tr>
                                                </thead>
                                                <tbody id="info_table">
                                                <tr role="row" class="odd">
                                                    <td>
                                                        <strong>76543210</strong>
                                                    </td>
                                                    <td><strong>张三</strong></td>
                                                    <td><strong>男</strong></td>
                                                    <td><strong>副教授</strong></td>
                                                    <td>
                                                        <div class="container">
                                                            <button type="button" class="btn btn-outline-primary"
                                                                    style="margin-right: 20px;" data-toggle="modal" data-target="#editteacher">编辑
                                                            </button>
                                                            <button type="button" class="btn btn-outline-danger" data-toggle="modal" data-target="#delete">删除
                                                            </button>
                                                        </div>
                                                    </td>
                                                </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-sm-12 col-md-5">
                                            <div class="dataTables_info" id="example1_info" role="status"
                                                 aria-live="polite">
                                                当前展示<span id="begin">1</span>到 <span id="end">10</span>条记录，共 <span
                                                    id="sum">57</span> 条
                                            </div>
                                        </div>
                                        <div class="col-sm-12 col-md-5">
                                            <button type="button" class="btn btn-outline-primary" id="prepage">前一页
                                            </button>
                                            <span style="margin-right: 15px; margin-left: 15px;"
                                                  id="currentpage">1</span>
                                            <button type="button" class="btn btn-outline-primary" id="nextpage">后一页
                                            </button>
                                        </div>
                                        <div class="col-sm-12 col-md-2">
                                            <div class="input-group input-group-sm">
                                                <input type="text" class="form-control" placeholder="跳转页码"
                                                       id="gotopage">
                                                <span class="input-group-append">
                                                    <button type="button" class="btn btn-info btn-flat" id="gotoButton">Go!</button>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- /.card-body -->
                        </div>
                        <!-- /.card -->
                    </div>
                    <!-- /.col -->
                </div>
                <!-- /.row -->
            </div>
            <!-- /.container-fluid -->
        </section>
        <!-- /.content -->
    </div>


    <div class="modal fade" id="newteacher" data-backdrop="static" data-keyboard="false"
         tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <span><strong>添加教师信息</strong></span>
                </div>
                <div class="modal-body" style="min-height: 200px;">
                    <div class="tab-content">
                        <div class="input-group" style="margin-bottom: 20px;">
                            <span class="input-group-text" style="height: 40px;"><strong>教师名称</strong></span>
                            <input class="form-control" aria-label="With textarea"
                                   placeholder="请输入教师名称" style="height: 40px;" id="teachernameinput">
                        </div>

                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <label class="input-group-text"
                                       for="inputGroupSelect01">教师职称</label>
                            </div>
                            <select class="custom-select" id="teachertitleselect">
                                <option value="讲师">讲师</option>
                                <option value="副教授">副教授</option>
                                <option value="教授">教授</option>
                            </select>
                        </div>

                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <label class="input-group-text"
                                       for="inputGroupSelect01">教师性别</label>
                            </div>
                            <select class="custom-select" id="teachergenderselect">
                                <option value="男">男</option>
                                <option value="女">女</option>
                            </select>
                        </div>

                        <div class="input-group">
                            <span class="input-group-text" style="height: 40px;"><strong>教师密码</strong></span>
                            <input class="form-control" aria-label="With textarea"
                                      placeholder="请输入教师密码" style="height: 40px;" type="password" id="teacherpassword">
                        </div>


                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-danger" data-dismiss="modal">关闭</button>
                    <button type="button" class="btn btn-outline-primary" id="confirmadd">添加教师信息</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="editteacher" data-backdrop="static" data-keyboard="false"
         tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <span><strong>添加教师信息</strong></span>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" style="min-height: 200px;">
                    <div class="tab-content" id="custom-tabs-four-tabContent">
                        <div class="input-group" style="margin-bottom: 20px;">
                            <span class="input-group-text" style="height: 40px;"><strong>教师名称</strong></span>
                            <input class="form-control" aria-label="With textarea"
                                   placeholder="请输入教师名称" style="height: 40px;">
                        </div>

                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <label class="input-group-text"
                                       for="inputGroupSelect01">教师职称</label>
                            </div>
                            <select class="custom-select">
                                <option value="1">讲师</option>
                                <option value="2">副教授</option>
                                <option value="3">教授</option>
                            </select>
                        </div>

                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <label class="input-group-text"
                                       for="inputGroupSelect01">教师性别</label>
                            </div>
                            <select class="custom-select" id="inputGroupSelect01">
                                <option value="1">男</option>
                                <option value="2">女</option>
                            </select>
                        </div>

                        <div class="input-group">
                            <span class="input-group-text" style="height: 40px;"><strong>教师密码</strong></span>
                            <input class="form-control" aria-label="With textarea"
                                      placeholder="请输入教师名称" style="height: 40px;" type="password">
                        </div>


                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-danger" data-dismiss="modal">关闭</button>
                    <button type="button" class="btn btn-outline-primary">添加教师信息</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="delete" style="display: none;" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <p class="modal-title">删除教师信息警告</p>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group" style="text-align: center;">
                            <br>
                            <label><h4>确认删除教师信息吗吗？</h4></label>
                        </div>
                    </div>
                    <div class="modal-footer justify-content-end">
                        <button type="button" class="btn btn-outline-primary" data-dismiss="modal">取消</button>
                        <button type="button" class="btn btn-outline-danger">确认删除</button>
                    </div>
                </div>
                <!-- /.modal-content -->
            </div>
            <!-- /.modal-dialog -->
        </div>

    <footer class="main-footer">
        <div class="float-right d-none d-sm-block">
            <b>Version</b> 1.0.0
        </div>
        <strong>Copyright © 2014-2020 <a href="#">Exam_Online</a>.</strong> All rights reserved.
    </footer>



</div>
<!-- REQUIRED SCRIPTS -->

<!-- jQuery -->
<script src="/static/js/jquery-3.5.1.min.js"></script>
<!-- Bootstrap 4 -->
<script src="/static/bootstrap/js/bootstrap.bundle.min.js"></script>
<!-- AdminLTE App -->
<script src="/static/adminlte/js/adminlte.min.js"></script>
<script>
    $(function () {
        $('.check-btn').click(function () {
            if ($(this).attr('checked') === 'checked') {
                $(this).removeAttr('checked');
                $(this).removeClass('btn-primary');
                $(this).addClass('btn-outline-primary');
            } else {
                $(this).attr('checked', true);
                $(this).removeClass('btn-outline-primary');
                $(this).addClass('btn-primary');
            }
        });
    });
</script>

<script type="text/javascript">
    $(function () {
        //存储科目信息
        subject_dict = new Object();
        subject_dict[0] = null;
        subject_dict[1] = '讲师';
        subject_dict[2] = '副教授';
        subject_dict[3] = '教授';
        //当前页面初始化为1
        let current_page = 1;
        let page_num = 0;
        let info_num = 0;
        let info_pno_list = [];
        let letter_list = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z'];
        let paper_list = new Array(10);
        let url_data = new Object();
        let temp_html;

        //判断按钮是否禁用
        function judge_button_disabled() {
            if (current_page === 1) {
                $('#prepage').addClass('disabled');
                $('#prepage').attr('disabled', 'disabled');
            } else {
                $('#prepage').removeClass('disabled');
                $('#prepage').removeAttr('disabled');
            }

            if (current_page === page_num) {
                $('#nextpage').addClass('disabled');
                $('#nextpage').attr('disabled', 'disabled');
            } else {
                $('#nextpage').removeClass('disabled');
                $('#nextpage').removeAttr('disabled');
            }
        }

        //更新页码
        function update_page_number() {
            //左下角数据记录修改
            $('#begin').text((current_page - 1) * 10 + 1);
            let after_num = info_num - (current_page - 1) * 10;
            if (after_num >= 10)
                $('#end').text(current_page * 10);
            else
                $('#end').text(info_num);
            //当前页面修改
            $('#currentpage').text(current_page);
        }

        //数组操作函数
        function array_clear_out(array_list) {
            for (let i = 0; i < array_list.length; i++) {
                array_list[i] = null;
            }
        }

        //编辑模态框动态html
        function modal_html_append(index) {
            let load_html = '';
            for (let i = 0; i < course_list.length; i++)
                load_html += "<option value=\"" + i + "\">" + course_list[i] + "</option>";
            return load_html;
        }

        //动态加载模态框信息
        function load_release_modal() {
            for (let i = 0; i < paper_list.length; i++) {
                let name = '#release' + i;
                let preview_name = "#preview" + i;
                let modal_name = '#modalrelease' + i;
                $(modal_name).on('show.bs.modal', function () {
                    let load_html = modal_html_append(i);
                    let course_name = modal_name + " #courseselect" + i;
                    $(course_name).empty();
                    $(course_name).append(load_html);
                });

                $(name).click(function () {
                    $(modal_name).modal('show');
                });
                $(preview_name).click(function () {
                    console.log("目标预览试卷：" + info_pno_list[i]);
                    window.open("/paper/preview?pno=" + info_pno_list[i]);
                });
            }
        }


        //动态载入表单 TODO
        function load_table() {
            $('#info_table').empty();
            //动态载入数据
            // console.log(paper_list);
            for (let i = 0; i < paper_list.length; i++) {
                //表格信息html添加
                temp_html = "<tr role='row' class='odd'>";
                temp_html += "<td><strong>" + paper_list[i]['no'] + "</strong></td>";
                temp_html += "<td><strong>" + paper_list[i]['name'] + "</strong></td>";
                temp_html += "<td><strong>" + paper_list[i]['gender'] + "</strong></td>";
                temp_html += "<td><strong>" + paper_list[i]['title'] + "</strong></td>";
                temp_html += "<td>";
                temp_html += "<div class=\"container\">";
                temp_html += "<button type=\"button\" class=\"btn btn-outline-primary\" style=\"margin-right: 20px;\" id='edit" + i + "'>编辑</button>\n";
                temp_html += "<button type=\"button\" class=\"btn btn-outline-danger\" data-toggle=\"modal\" data-target=\"#modaldelete" + i + "\" id='delete" + i + "'>删除</button>";
                temp_html += "</div>";
                temp_html += "</td>";
                temp_html += "</tr>";
                $('table').append(temp_html);
            }
            load_release_modal();
        }

        //更新函数
        function update_all() {
            load_table();
            judge_button_disabled();
            update_page_number();
        }

        //获取初始试题界面的总页数并分页
        $.ajax({
            url: '/mentor',
            method: 'get',
            success: function (data) {
                if (data['code'] === 200) {
                    page_num = data['page_num'];
                    info_num = data['info_num'];
                    $('#sum').text(info_num);
                    update_page_number();
                } else {
                    console.log('获取页面出错！');
                }
            },
        });

        array_clear_out(paper_list);

        //获取初始试卷界面的第一页试卷
        url_data['page'] = 1;

        $.ajax({
            url: '/mentor',
            method: 'get',
            data: url_data,
            success: function (data) {
                if (data['code'] === 200) {
                    paper_list = data['mentors'];
                    load_table();
                    //初始化翻页按钮
                    judge_button_disabled();
                }
            }
        });


        //前翻页按钮click事件
        $('#prepage').click(function () {
            current_page--;
            if (current_page <= 0 || current_page > page_num)
                console.log("当前页码标定错误！");
            else {
                url_data['page'] = current_page;
                $.ajax({
                    url: '/mentor',
                    method: 'get',
                    data: url_data,
                    success: function (data) {
                        if (data['code'] === 200) {
                            paper_list = data['mentors'];
                            info_num = data['info_num'];
                            page_num = data['page_num'];
                            $('#sum').text(info_num);
                            update_all();
                        }

                    }
                });
            }

        });

        //后翻页按钮click事件
        $('#nextpage').click(function () {
            current_page++;
            if (current_page <= 0 || current_page > page_num)
                console.log("当前页码标定错误！");
            else {
                url_data['page'] = current_page;
                $.ajax({
                    url: '/mentor',
                    method: 'get',
                    data: url_data,
                    success: function (data) {
                        if (data['code'] === 200) {
                            paper_list = data['mentors'];
                            info_num = data['info_num'];
                            page_num = data['page_num'];
                            $('#sum').text(info_num);
                            update_all();
                        }
                    }
                });
            }

        });

        //跳转页按钮click事件
        $('#gotoButton').click(function () {
            let goto = parseInt($.trim($('#gotopage').val()));
            if (goto < 1 || goto > page_num)
                alert('页码超出范围！');
            else {
                current_page = goto;
                url_data['page'] = current_page;
                $.ajax({
                    url: '/mentor',
                    method: 'get',
                    data: url_data,
                    success: function (data) {
                        if (data['code'] === 200) {
                            paper_list = data['mentors'];
                            info_num = data['info_num'];
                            page_num = data['page_num'];
                            $('#sum').text(info_num);
                            update_all();
                        }
                    }
                });
            }
        });


        //班级管理按钮click事件
        $('#mentor-manage').click(function () {
            location.href = '/index';
        });
        //试卷管理按钮click事件
        $('#student-manage').click(function () {
            location.href = '/student/manage';
        });
        //退出管理按钮click事件
        $('#logout').click(function () {
            $.ajax({
                url: '/auth/logout',
                method: 'post',
                success: function (data) {
                    if (data['code'] === 200)
                        location.href = '/auth/login';
                }
            })
        });


        //职称筛选按钮click事件
        for (let i = 0; i < 8; i++) {
            let subnumber = '.s000' + i;
            $(subnumber).click(function () {
                if (i === 0)
                    delete url_data['title'];
                else if(i === 1)
                    url_data['title'] = '讲师';
                else if(i === 2)
                    url_data['title'] = '副教授';
                else
                    url_data['title'] = '教授';
                url_data['page'] = 1;
                $.ajax({
                    url: '/mentor',
                    method: 'get',
                    data: url_data,
                    success: function (data) {
                        if (data['code'] === 200) {
                            if (i === 0) {
                                $('#dropdownMenuLink1').text('按职称筛选');
                                $('#dropdownMenuLink1').addClass('btn-outline-primary');
                                $('#dropdownMenuLink1').removeClass('btn-primary');
                            } else {
                                $('#dropdownMenuLink1').text('按' + subject_dict[i] + '筛选');
                                $('#dropdownMenuLink1').addClass('btn-primary');
                                $('#dropdownMenuLink1').removeClass('btn-outline-primary');
                            }
                            info_num = data['info_num'];
                            page_num = data['page_num'];
                            current_page = 1;
                            $('#sum').text(info_num);
                            paper_list = data['mentors'];
                            update_all();
                        }
                    }
                })
            });
        }



        //试卷名搜索按钮click事件
        $('#namesearch').click(function () {
            let content_input = $('#nameinput').val();
            if (content_input === null)
                ;
            else {
                url_data['name'] = content_input;
                url_data['page'] = 1;
                $.ajax({
                    url: '/mentor',
                    method: 'get',
                    data: url_data,
                    success: function (data) {
                        if (data['code'] === 200) {
                            info_num = data['info_num'];
                            page_num = data['page_num'];
                            current_page = 1;
                            $('#sum').text(info_num);
                            paper_list = data['mentors'];
                            update_all();
                        }
                    }
                })
            }

        });

        //新建试卷按钮click事件
        $('#createNewPaper').click(function () {
            location.href = '/paper/assemble';
        });


        //删除按钮click事件
        for (let i = 0; i < paper_list.length; i++) {
            let name = '#confirmdelete' + i;

            $(name).click(function () {

                $.ajax({
                    url: '/paper/?pno=' + info_pno_list[i],
                    method: 'DELETE',
                    success: function (data) {
                        if (data['code'] === 200) {
                            info_num--;
                            page_num = Math.ceil(info_num);
                            $('#sum').text(info_num);
                            url_data['page'] = 1;
                            $.ajax({
                                url: '/paper',
                                method: 'get',
                                data: url_data,
                                success: function (data) {
                                    if (data['code'] === 200) {
                                        info_num = data['info_num'];
                                        page_num = data['page_num'];
                                        current_page = 1;
                                        $('#sum').text(info_num);
                                        paper_list = data['papers'];
                                        update_all();
                                    }
                                }
                            })
                        }
                    }
                });
            });
        }

        //发布考试click事件
        for (let i = 0; i < paper_list.length; i++) {
            let release_name = "#confirmrelease" + i;
            $(release_name).click(function () {
                let test_name = $("#testname" + i).val();
                let cno = $("#courseselect" + i).val();
                let timelimit_option = $("#timelimitselect" + i).val();
                let reservation = ($("#reservationtime" + i).val()).split(" - ");
                let start_time = Date.parse(reservation[0]);
                let end_time = Date.parse(reservation[1]);
                let describe_text = $("#describe" + i).val();

                if (timelimit_option === 2) {
                    $.ajax({
                        url: "/exam",
                        method: 'post',
                        data: {
                            "pno": i,
                            "cno": cno,
                            "tname": test_name,
                            "tdesc": describe_text,
                        },
                        success: function (data) {
                            if(data["code"] == 200){
                                console.log("发布成功！");
                            }else{
                                console.log("发布失败！");
                            }
                        }
                    });
                }else{
                    $.ajax({
                        url: "/exam",
                        method: 'post',
                        data: {
                            "pno": i,
                            "cno": cno,
                            "tname": test_name,
                            "tdesc": describe_text,
                            "tstart": start_time,
                            "tend": end_time
                        },
                        success: function (data) {
                            if(data["code"] == 200){
                                console.log("发布成功！");
                            }else{
                                console.log("发布失败！");
                            }
                        }
                    });
                }

                $('#modalrelease' + i).modal('hide');
            });
        }

        $('#confirmadd').click(function () {
            let name = $('#teachernameinput').val();
            let title = $('#teachertitleselect').val();
            let gender = $('#teachergenderselect').val();
            let password = $('#teacherpassword').val();
            if(name === "" || title === "")
                alert("请检查！");
            else{
                $.ajax({
                    url: ''
                });
            }
        });

        //动态加载班级信息
        let course_list = new Array();
        let course_num_list = new Array();
        $.ajax({
            url: '/class/list',
            method: 'get',
            success: function (data) {
                if (data['code'] === 200) {
                    for (let i = 0; i < data['classes'].length; i++) {

                        course_list[i] = data['classes'][i]['cname'];
                        course_num_list[i] = data['classes'][i]['cno'];
                    }
                    //此处只读入班级信息，在模态框动态加载的时候考虑该问题
                }
            }
        });


    });
</script>

</body>
</html>
